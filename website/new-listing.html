<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>GB&M – New Listing</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles/default.css">
  <link rel="stylesheet" href="styles/new-listing.css">
  <script src="javascript/api.js"></script>
</head>
<body>
<header>
  <div class="header-wrap">
    <a class="brand" href="index.html">
      <div class="logo">GB</div>
      <div class="title">GitBooks & MORE</div>
    </a>
    <div></div>
    <nav>
      <a href="marketplace.html">Marketplace</a>
      <a href="signup.html">Account</a>
    </nav>
  </div>
</header>

<main class="wrap">
  <div class="card">
    <h1 class="h1-heading">New Listing</h1>
    <form id="listingForm" novalidate>
      <label for="title">Item Title *</label>
      <input id="title" required placeholder="e.g., Data Structures (4th ed.)" />

      <label for="category">Category *</label>
      <select id="category" required>
        <option value="">Select a category</option>
        <option>Textbooks</option>
        <option>Calculators</option>
        <option>Lab Kits</option>
        <option>Other</option>
      </select>

      <div class="row-3">
        <div>
          <label for="isbn">ISBN (if textbook)</label>
          <input id="isbn" placeholder="e.g., 9780134685991" />
        </div>
        <div>
          <label for="course">Course #</label>
          <input id="course" placeholder="e.g., ITSC 3146" />
        </div>
        <div>
          <label for="price">Price ($) *</label>
          <input id="price" type="number" min="0" step="0.01" required />
        </div>
      </div>

      <label for="desc">Description (mention professor if relevant)</label>
      <textarea id="desc" placeholder="Condition, professor, notes, semester…"></textarea>

      <div class="row">
        <div class="upload">
          <input id="file" type="file" accept="image/*" />
          <div class="preview" id="preview">Image preview</div>
          <small>PNG/JPG up to 10MB</small>
        </div>
        <div>
          <button class="btn mt-8" type="submit">Post Listing</button>
          <div id="formMsg" class="msg mt-8"></div>
        </div>
      </div>
    </form>
  </div>
</main>

<script>
  // image preview
  const file=document.getElementById('file'), preview=document.getElementById('preview');
  file.addEventListener('change',()=>{ 
    const f=file.files[0]; 
    if(!f) return; 
    const url=URL.createObjectURL(f); 
    preview.innerHTML=''; 
    const img=new Image(); 
    img.src=url; 
    img.style.width='100%'; 
    img.style.height='100%'; 
    img.style.objectFit='cover'; 
    preview.appendChild(img); 
  });

  // simple validators
  const rxISBN=/^(97(8|9))?\d{9}(\d|X)$/i;
  document.getElementById('listingForm').addEventListener('submit',e=>{
    e.preventDefault();
    const title=titleInput.value?.trim?.() ?? document.getElementById('title').value.trim();
    const category=document.getElementById('category').value;
    const isbn=document.getElementById('isbn').value.trim();
    const course=document.getElementById('course').value.trim();
    const price=document.getElementById('price').value;
    const msg=document.getElementById('formMsg');

    if(!title || !category || price===''){ 
      msg.textContent='Title, Category, and Price are required.'; 
      msg.className='msg error'; 
      return; 
    }
    if(isbn && !rxISBN.test(isbn)){ 
      msg.textContent='ISBN format looks wrong. You can leave it blank if unsure.'; 
      msg.className='msg error'; 
      return; 
    }

    const payload = { 
      title, 
      category, 
      isbn: isbn || null, 
      course: course || null, 
      price: Number(price), 
      description: document.getElementById('desc').value.trim() 
    };
    console.log('Listing payload:', payload);

    msg.textContent='Listing posted!'; 
    msg.className='msg ok';
    setTimeout(()=>location.href='marketplace.html',700);
  });

  const titleInput=document.getElementById('title');
</script>
<script src="javascript/api.js"></script>
<script src="javascript/new-listing.js"></script>
</body>
</html>
