<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>GB&M – New Listing</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{--bg:#0b1020;--brand:#5b8cff}
    body{margin:0;background:#f7f7fb;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    header{background:var(--bg);color:#fff}
    .header-wrap{max-width:1100px;margin:0 auto;padding:10px 16px;display:grid;grid-template-columns:auto 1fr auto;gap:16px;align-items:center}
    .brand{display:flex;align-items:center;gap:10px;text-decoration:none;color:#fff}
    .logo{width:40px;height:40px;border-radius:8px;background:#1f2a5a;display:grid;place-items:center;font-weight:800}
    .title{font-weight:800}
    nav a{color:#e5e7eb;text-decoration:none;margin-left:12px;padding:8px 10px;border-radius:8px}
    nav a:hover{background:rgba(255,255,255,.1)}
    .wrap{max-width:860px;margin:24px auto;padding:16px}
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:14px;padding:22px}
    form{display:grid;gap:12px}
    label{font-weight:600}
    input,textarea,select{padding:10px;border:1px solid #d1d5db;border-radius:10px;width:100%}
    textarea{min-height:110px;resize:vertical}
    .upload{border:2px dashed #c7d2fe;border-radius:12px;padding:18px;text-align:center;background:#f8faff}
    .btn{background:var(--brand);color:#fff;border:none;border-radius:10px;padding:10px 14px;cursor:pointer}
    .row{display:grid;gap:12px;grid-template-columns:1fr 1fr}
    .row-3{display:grid;gap:12px;grid-template-columns:1fr 1fr 1fr}
    .preview{aspect-ratio:1/1;background:#eef2ff;border-radius:10px;display:grid;place-items:center;color:#4f46e5}
    .msg{font-size:.95rem}.error{color:#b91c1c}.ok{color:#065f46}
    @media (max-width:820px){.row,.row-3{grid-template-columns:1fr}}
  </style>
</head>
<body>
<header>
  <div class="header-wrap">
    <a class="brand" href="index.html"><div class="logo">GB</div><div class="title">GitBooks & MORE</div></a>
    <div></div>
    <nav><a href="marketplace.html">Marketplace</a><a href="signup.html">Account</a></nav>
  </div>
</header>


<!-- New Listing form: required (title, category, price) + optional (ISBN, course).
 - ISBN & course support future recommendations.
 - POST to /listings and handle file uploads in Sprint 2. -->


<main class="wrap">
  <div class="card">
    <h1 style="margin:.2rem 0 1rem">New Listing</h1>
    <form id="listingForm" novalidate>
      <label for="title">Item Title *</label>
      <input id="title" required placeholder="e.g., Data Structures (4th ed.)" />

      <label for="category">Category *</label>
      <select id="category" required>
        <option value="">Select a category</option>
        <option>Textbooks</option>
        <option>Calculators</option>
        <option>Lab Kits</option>
        <option>Other</option>
      </select>

      <div class="row-3">
        <div>
          <label for="isbn">ISBN (if textbook)</label>
          <input id="isbn" placeholder="e.g., 9780134685991" />
        </div>
        <div>
          <label for="course">Course #</label>
          <input id="course" placeholder="e.g., ITSC 3146" />
        </div>
        <div>
          <label for="price">Price ($) *</label>
          <input id="price" type="number" min="0" step="0.01" required />
        </div>
      </div>

      <label for="desc">Description (mention professor if relevant)</label>
      <textarea id="desc" placeholder="Condition, professor, notes, semester…"></textarea>

      <div class="row">
        <div class="upload">
          <input id="file" type="file" accept="image/*" />
          <div class="preview" id="preview">Image preview</div>
          <small>PNG/JPG up to 10MB</small>
        </div>
        <div>
          <button class="btn" type="submit" style="margin-top:8px">Post Listing</button>
          <div id="formMsg" class="msg" style="margin-top:8px"></div>
        </div>
      </div>
    </form>
  </div>
</main>

<script>
  // image preview
  const file=document.getElementById('file'), preview=document.getElementById('preview');
  file.addEventListener('change',()=>{ const f=file.files[0]; if(!f) return; const url=URL.createObjectURL(f); preview.innerHTML=''; const img=new Image(); img.src=url; img.style.width='100%'; img.style.height='100%'; img.style.objectFit='cover'; preview.appendChild(img); });

  // simple validators (replace with real API later)
  const rxISBN=/^(97(8|9))?\d{9}(\d|X)$/i; // loose check
  document.getElementById('listingForm').addEventListener('submit',e=>{
    e.preventDefault();
    const title=titleInput.value?.trim?.() ?? document.getElementById('title').value.trim(); // Safari fallback
    const category=document.getElementById('category').value;
    const isbn=document.getElementById('isbn').value.trim();
    const course=document.getElementById('course').value.trim();
    const price=document.getElementById('price').value;
    const msg=document.getElementById('formMsg');

    if(!title || !category || price===''){ msg.textContent='Title, Category, and Price are required.'; msg.className='msg error'; return; }
    if(isbn && !rxISBN.test(isbn)){ msg.textContent='ISBN format looks wrong. You can leave it blank if unsure.'; msg.className='msg error'; return; }

    // On success: collect payload (ready for backend POST)
    const payload = { title, category, isbn: isbn || null, course: course || null, price: Number(price), description: document.getElementById('desc').value.trim() };
    console.log('Listing payload:', payload);

    msg.textContent='Listing posted!'; msg.className='msg ok';
    setTimeout(()=>location.href='marketplace.html',700);
  });

  const titleInput=document.getElementById('title');
</script>
</body>
</html>
