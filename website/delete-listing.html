<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>GB&M – Home</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles/default.css">
  <link rel="stylesheet" href="styles/index.css">

</head>
<body>
<header>
  <div class="header-wrap">
    <a class="brand" href="index.html"><div class="logo">GB</div><div class="title">GitBooks & MORE</div></a>
    <div></div>
    <nav>
      <a href="marketplace.html">Marketplace</a>
      <a href="new-listing.html">Sell an Item</a>
      <a href="manage-listings.html">My Listings</a>
    </nav>
  </div>
</header>

<main class="wrap">
  <section class="panel">
    <h2 style="margin-top:0">Delete Listing</h2>
    <p id="desc" class="muted">Loading…</p>
    <div class="row">
      <button id="cancel" class="btn btn-outline" type="button">Cancel</button>
      <button id="del" class="btn danger">Delete</button>
    </div>
  </section>
</main>

<script>
function qs(k){return new URLSearchParams(location.search).get(k)}
const id = Number(qs('id'));
const currentUserId = Number(localStorage.getItem('gbmo_currentUserId')||'42');
function getListings(){return JSON.parse(localStorage.getItem('gbmo_listings')||'[]')}
function setListings(v){localStorage.setItem('gbmo_listings',JSON.stringify(v))}

const p = document.getElementById('desc');
const btnDel = document.getElementById('del');

const all = getListings();
const listing = all.find(x=>x.id===id);

if(!listing){ p.textContent='Listing not found.'; btnDel.disabled=true; }
else if(listing.ownerId!==currentUserId){ p.textContent='Unauthorized to delete this listing.'; btnDel.disabled=true; }
else { p.innerHTML = `Are you sure you want to delete <strong>${listing.title}</strong> (ID #${id})? This cannot be undone.`; }

document.getElementById('cancel').addEventListener('click',()=>history.back());
btnDel.addEventListener('click',()=>{
  if(!listing) return;
  const remaining = all.filter(x=>x.id!==listing.id);
  setListings(remaining);
  location.href = 'manage-listings.html';
});
</script>
</body>
</html>
